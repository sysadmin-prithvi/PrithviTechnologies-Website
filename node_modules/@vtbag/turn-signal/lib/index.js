"use strict";(()=>{var l,i,g,r,p,b=e=>{history.state?.vtbagId??history.replaceState({vtbagId:history.length},""),i=parseInt(sessionStorage.getItem("vtbag-id")??"NaN",10),r=history.state.vtbagId,l=sessionStorage.getItem("vtbag-navigation-type"),sessionStorage.setItem("vtbag-id",""+r),g=sessionStorage.getItem("vtbag-from"),p=sessionStorage.getItem("vtbag-to")};addEventListener("pagereveal",b);var y=e=>{l=e.activation.navigationType,g=e.activation.from.url??"",p=e.activation.entry.url??"",i=history.state?.vtbagId,r=l==="push"?i+(g===p?0:1):l==="replace"?i:e.activation.entry.index!==-1?i+(e.activation.entry.index-e.activation.from.index):NaN,sessionStorage.setItem("vtbag-navigation-type",l),sessionStorage.setItem("vtbag-from",g),sessionStorage.setItem("vtbag-to",p)};addEventListener("pageswap",y);var c=document.currentScript;function w(e,a){let t,n,s=["backward","same","forward"],o=c.dataset.directionAttribute;return o&&(s=o.trim().split(/\s*,\s*/),s.length!==4?console.error(`[turn-signal] syntax error: data-direction-attribute value "${o}" does not match "attributeName, backwardValue, sameValue, forwardValue"`):(n=s.shift(),t=e<a?s[0]:e===a?s[1]:s[2])),{attributeName:n,value:t}}function S(e,a){let t=["backward","same","forward"],n=c.dataset.directionTypes;if(n&&(t=n.trim().split(/\s*,\s*/),t.length!==3)){console.error(`[turn-signal] syntax error: data-direction-types value "${n}" does not match "backwardValue, sameValue, forwardValue"`);return}return e<a?t[0]:e===a?t[1]:t[2]}function m(e){if(!e.viewTransition)return;let a=r,t=i,n=h();if(n.length&&(t=n.indexOf(new URL(g??".",location.href).pathname),a=n.indexOf(new URL(p??".",location.href).pathname)),sessionStorage.removeItem("vtbag-signal-attribute"),sessionStorage.removeItem("vtbag-signal-type"),!isNaN(a)){let{attributeName:s,value:o}=w(a,t);s&&o&&(document.documentElement.setAttribute(s,o),e.viewTransition.finished.then(()=>document.documentElement.removeAttribute(s)),sessionStorage.setItem("vtbag-signal-attribute",`${s} ${o}`)),o=S(a,t),o&&(e.viewTransition.types.add(o),sessionStorage.setItem("vtbag-signal-type",o))}e.viewTransition.types.add(e.type==="pageswap"?"old":"new")}function h(){let e=c.dataset.selector;return e?[...document.querySelectorAll(e)].map(t=>new URL(t.href??".",location.href).pathname):[]}"onpageswap"in window&&addEventListener("pageswap",m);"onpagereveal"in window&&addEventListener("pagereveal",m);var v=null,T=()=>{document.addEventListener("click",e=>{let a=e.composedPath()[0];v=a instanceof Element?a.closest("a, area"):null})};addEventListener("DOMContentLoaded",T);function u(){return v}var E="data-vtbag-link-types",d="vtbag-all-link-types",I=e=>{let a=u();if(!e.viewTransition)return;let t=JSON.parse(sessionStorage.getItem(d)??"[]"),n="";if(!isNaN(r))if(r<i)n=(t[r]??"").split(/\s*\/\s*/)[0]??"";else{l==="traverse"?n=t[i]:(a&&(n=a.getAttribute(E)??""),t[i]=n,sessionStorage.setItem(d,JSON.stringify(t)));let s=n.split(/\s*\/\s*/);i===r?n=s[~~((s.length-1)/2)]??"":n=s[s.length-1]??""}f(n+" old",e)};addEventListener("pageswap",I);var L=e=>{if(!e.viewTransition)return;let a=JSON.parse(sessionStorage.getItem(d)??"[]"),t=a[r]??"";if(r<i)t=t.split(/\s*\/\s*/)[0]??"";else{let n=(a[i]??"").split(/\s*\/\s*/);i===r?t=n[~~((n.length-1)/2)]??"":t=n[n.length-1]??""}f(t+" new",e)};addEventListener("pagereveal",L);function f(e,a){let t=e.trim();return t.length>0&&t.split(/\s+/).forEach(n=>a.viewTransition?.types?.add(n)),e}})();
