"use strict";(()=>{var l,s,g,o,p,y=e=>{history.state?.vtbagId??history.replaceState({vtbagId:history.length},""),s=parseInt(sessionStorage.getItem("vtbag-id")??"NaN",10),o=history.state.vtbagId,l=sessionStorage.getItem("vtbag-navigation-type"),sessionStorage.setItem("vtbag-id",""+o),g=sessionStorage.getItem("vtbag-from"),p=sessionStorage.getItem("vtbag-to")};addEventListener("pagereveal",y);var w=e=>{l=e.activation.navigationType,g=e.activation.from.url??"",p=e.activation.entry.url??"",s=history.state?.vtbagId,o=l==="push"?s+(g===p?0:1):l==="replace"?s:e.activation.entry.index!==-1?s+(e.activation.entry.index-e.activation.from.index):NaN,sessionStorage.setItem("vtbag-navigation-type",l),sessionStorage.setItem("vtbag-from",g),sessionStorage.setItem("vtbag-to",p)};addEventListener("pageswap",w);var c=document.currentScript;function b(e,a){let t,n,i=["backward","same","forward"],r=c.dataset.directionAttribute;return r&&(i=r.trim().split(/\s*,\s*/),i.length!==4?console.error(`[turn-signal] syntax error: data-direction-attribute value "${r}" does not match "attributeName, backwardValue, sameValue, forwardValue"`):(n=i.shift(),t=e<a?i[0]:e===a?i[1]:i[2])),{attributeName:n,value:t}}function T(e,a){let t=["backward","same","forward"],n=c.dataset.directionTypes;if(n&&(t=n.trim().split(/\s*,\s*/),t.length!==3)){console.error(`[turn-signal] syntax error: data-direction-types value "${n}" does not match "backwardValue, sameValue, forwardValue"`);return}return e<a?t[0]:e===a?t[1]:t[2]}function v(e){if(!e.viewTransition)return;let a=o,t=s,n=S();if(n.length&&(t=n.indexOf(new URL(g??".",location.href).pathname),a=n.indexOf(new URL(p??".",location.href).pathname)),sessionStorage.removeItem("vtbag-signal-attribute"),sessionStorage.removeItem("vtbag-signal-type"),!isNaN(a)){let{attributeName:i,value:r}=b(a,t);i&&r&&(document.documentElement.setAttribute(i,r),e.viewTransition.finished.then(()=>document.documentElement.removeAttribute(i)),sessionStorage.setItem("vtbag-signal-attribute",`${i} ${r}`)),r=T(a,t),r&&(e.viewTransition.types.add(r),sessionStorage.setItem("vtbag-signal-type",r))}e.viewTransition.types.add(e.type==="pageswap"?"old":"new")}function S(){let e=c.dataset.selector;return e?[...document.querySelectorAll(e)].map(t=>new URL(t.href??".",location.href).pathname):[]}"onpageswap"in window&&addEventListener("pageswap",v);"onpagereveal"in window&&addEventListener("pagereveal",v);var m=null,h=()=>{document.addEventListener("click",e=>{let a=e.composedPath()[0];m=a instanceof Element?a.closest("a, area"):null})};addEventListener("DOMContentLoaded",h);function u(){return m}var E="data-vtbag-link-types",d="vtbag-all-link-types",I=e=>{let a=u();if(!e.viewTransition)return;let t=JSON.parse(sessionStorage.getItem(d)??"[]"),n="";if(!isNaN(o))if(o<s)n=(t[o]??"").split(/\s*\/\s*/)[0]??"";else{l==="traverse"?n=t[s]:(a&&(n=a.getAttribute(E)??""),t[s]=n,sessionStorage.setItem(d,JSON.stringify(t)));let i=n.split(/\s*\/\s*/);s===o?n=i[~~((i.length-1)/2)]??"":n=i[i.length-1]??""}f(n+" old",e)};addEventListener("pageswap",I);var L=e=>{if(!e.viewTransition)return;let a=JSON.parse(sessionStorage.getItem(d)??"[]"),t=a[o]??"";if(o<s)t=t.split(/\s*\/\s*/)[0]??"";else{let n=(a[s]??"").split(/\s*\/\s*/);s===o?t=n[~~((n.length-1)/2)]??"":t=n[n.length-1]??""}f(t+" new",e)};addEventListener("pagereveal",L);function f(e,a){let t=e.trim();return t.length>0&&t.split(/\s+/).forEach(n=>a.viewTransition?.types?.add(n)),e}addEventListener("pagereveal",e=>{console.log("pagereveal",l?.slice(0,4),s,g),console.log("          ","->  ",o,p),e.viewTransition&&console.log("types: ",...e.viewTransition?.types)});addEventListener("pageswap",e=>{console.log("pageswap  ",l?.slice(0,4),s,g),console.log("          ","->  ",o,p),e.viewTransition&&console.log("types:",...e.viewTransition.types)});})();
